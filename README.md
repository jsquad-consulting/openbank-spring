# OpenBank - Spring Boot 2 application server

[![Build Status](https://travis-ci.org/jsquad-consulting/openbank-spring.svg?branch=master)](https://travis-ci.org/jsquad-consulting/openbank-spring)

## Requirements

* JDK 11
* Maven 3.6.0
* Docker 1.19+

## UML Diagram generation

By default, uml diagrams are generated by the build setup and stored at the root diagrams directory.

Generate the graphvis dot files to pdf by the command:

`find . -type f -name "*.dot" -exec sh -c 'dot -Tpdf "${0}" -o "${0%.*}.pdf"' {} \;`

## Package OpenBank application

```bash
mvn clean install -T 1C -DskipTests
```

## Start the application

### With Docker Compose

```bash
source setup_environment_variables.sh
docker-compose -f service/docker-compose.yaml up --build --force-recreate
```

### With Kubernetes

```bash
source setup_environment_variables.sh
./start_openbank_in_kubernetes_cluster.sh
```

## Run unit/system tests

```bash
mvn clean install -T 1C
```

## Run integration tests

Prepare the environment with 'secret' environment variables.

```bash
source setup_environment_variables.sh
```

### Prepare for Docker environment

```bash
source setup_docker_environment.sh
```

### Prepare for Kubernetes environment

```bash
source setup_kubernetes_environment.sh
```

### Execute the integration tests for specific environment

```bash
mvn verify -Pintegrationtests
```

## Access on the fly RESTful API code generation

https://localhost:8443/v1/OpenBankAPI

## Reference to OpenApi version 3.0.1 for documentation tasks

http://spec.openapis.org/oas/v3.0.1


## Test the RESTful contracts

Load the src/main/resources/schema/OpenBankAPIv1.yaml file with the 
http://editor.swagger.io/ editor to easily test the RESTful 
contracts.

## Work with SSL

[Working with SSL](doc/working_with_ssl.MD)

## For SSL encryption for the application

Following commands was used:

````bash
# Generate private key and private csr file
openssl req -newkey rsa:2048 -nodes -keyout jsquad.key -out jsquad.csr

# Generate self signed key
openssl x509 -signkey jsquad.key -in jsquad.csr -req -days 365 -out jsquad.crt

# Generate PKCS12 key
openssl pkcs12 -inkey jsquad.key -in jsquad.crt -export -out jsquad.pfx
````

### Generate JKS encryption for integration test communicating with SSL encrypted OpenBank app server

````bash
keytool -importkeystore -srckeystore jsquad.pfx -destkeystore jsquad.jks -srcstoretype PKCS12 -deststoretype JKS \
-srcstorepass \<secret password\> -deststorepass test1234 -destkeypass test1234
````