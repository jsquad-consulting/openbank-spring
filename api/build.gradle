/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'se.jsquad.java-conventions'
}

java {
	toolchain {
		languageVersion.set(JavaLanguageVersion.of(11))
	}
}

test {
	useJUnitPlatform()
	filter {
		excludeTestsMatching("*IT")
	}
}

configurations {
	jaxb
}

dependencies {
    implementation 'org.springdoc:springdoc-openapi-core:1.1.49'
    implementation 'org.hibernate:hibernate-validator:6.0.17.Final'
    compileOnly 'io.swagger:swagger-core:1.5.21'

	jaxb(
		'com.sun.xml.bind:jaxb-impl:2.3.3',
		'jakarta.xml.bind:jakarta.xml.bind-api:2.3.3',
		'org.glassfish.jaxb:jaxb-runtime:2.3.3',
		'org.glassfish.jaxb:jaxb-xjc:2.3.3',
		'org.jvnet.jaxb2_commons:jaxb2-annotate-plugin-test-annox-annotations:1.0.0',
		'org.jvnet.jaxb2_commons:jaxb2-basics-annotate:1.1.0',
		'org.jvnet.jaxb2_commons:jaxb2-basics-runtime:1.11.1',
		'org.jvnet.jaxb2_commons:jaxb2-basics:1.11.1',
		'org.jvnet.jaxb2_commons:jaxb2-fluent-api:3.0',
		'org.springdoc:springdoc-openapi-core:1.1.49'
	)
}

task xjc {
	def xsds = "src/main/resources/schema/xsd"
	def xjbs = "src/main/resources/schema/config"
	def jaxbDir = "$buildDir/generated-sources/jaxb"
	inputs.dir "$xjbs"
	inputs.files "$xsds"
	outputs.dir "$jaxbDir"
	doFirst {
		System.setProperty('javax.xml.accessExternalSchema', 'all')
		mkdir "$jaxbDir"

		ant.taskdef(name: 'xjc', classname: 'com.sun.tools.xjc.XJCTask', classpath: configurations.jaxb.asPath)
		ant.xjc(
			destdir: "$jaxbDir"
		) {
			schema(dir: "$xsds", includes: '*.xsd')
			binding(dir: "$xjbs", includes: '*.xjb')
			arg(value: '-verbose')
			arg(value: '-extension')
			arg(value: '-Xannotate')
			arg(value: '-Xfluent-api')
		}
	}
}

description = 'api'

compileJava.dependsOn xjc

sourceSets.main.java.srcDirs = ["$buildDir/generated-sources/jaxb", "src/main/java"]

